<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="D.js : tiny promise/A+ implementation" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>D.js</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/malko/D.js">View on GitHub</a>

          <h1 id="project_title">D.js</h1>
          <h2 id="project_tagline">tiny promise/A+ implementation</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/malko/D.js/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/malko/D.js/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>D.js</h1>

<p>D.js is a tiny implementation of promises/A+ made for nodejs and client-side browser
<a href="https://travis-ci.org/malko/D.js"><img src="https://travis-ci.org/malko/D.js.png?branch=master" alt="Build Status"></a></p>

<p>If you want to know more about promises/A+ you can visit this page: <a href="http://promises-aplus.github.io/promises-spec/">http://promises-aplus.github.io/promises-spec/</a>
<a href="http://promises-aplus.github.com/promises-spec">
    <img src="http://promises-aplus.github.com/promises-spec/assets/logo-small.png" alt="Promises/A+ logo" title="Promises/A+ 1.0 compliant" align="right"></a></p>

<h2>installation</h2>

<h3>nodejs</h3>

<p><code>npm install d.js</code></p>

<h3>browsers</h3>

<p>clone the repository or just copy the files D.js or D.min.js to your server and then include it in your pages with a classic 
<code>&lt;script src="D.js"&gt;&lt;/script&gt;</code>
or using a javascript loader like <a href="https://github.com/malko/l.js">l.js</a></p>

<h2>Making an async method that return a promise:</h2>

<p>example in node js wrapping the fs.readFile function to work with promise</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">)</span>
    <span class="p">,</span> <span class="nx">D</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./D.js'</span><span class="p">)</span>
<span class="p">;</span>

<span class="c1">// define a method that will return a promise of a file read content</span>
<span class="kd">function</span> <span class="nx">readPromise</span><span class="p">(</span><span class="nx">filename</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">D</span><span class="p">();</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="nx">err</span> <span class="p">){</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// use our readPromise method we don't pass in a callback, we will pass it to the then method</span>
<span class="nx">readPromise</span><span class="p">(</span><span class="s1">'/etc/passwd'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="c1">// the then method return a promise as well so we can chain then calls</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span> <span class="p">}</span>
        <span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">)</span>
<span class="p">;</span>

</pre></div>

<h2>Addition to the Promises/A+ specs</h2>

<p>D.js offers a little more than the promises/A+ specification requirements here's the api:</p>

<h3>Promises methods</h3>

<p>In addition to the unique <strong>then</strong> method required by the specifications D.js add supports of the following to each promises:</p>

<div class="highlight"><pre><span class="nx">promise</span><span class="p">.</span><span class="nx">isPending</span><span class="p">()</span> <span class="c1">// return false if the promise is fulfilled or rejected, true otherwise</span>
<span class="nx">promise</span><span class="p">.</span><span class="nx">getStatus</span><span class="p">()</span> <span class="c1">// return -1 if rejected, 0 is pending and 1 if fulfilled</span>
<span class="nx">promise</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="nx">onFulfilled</span><span class="p">);</span> <span class="c1">// same as promise.then(onFulfilled);</span>
<span class="nx">promise</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">onRejected</span><span class="p">);</span>   <span class="c1">// same as promise.then(undefined,onRejected);</span>
<span class="nx">promise</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">onFulfilled</span><span class="p">,</span><span class="nx">onRejected</span><span class="p">);</span>
<span class="nx">promise</span><span class="p">.</span><span class="nx">rethrow</span><span class="p">(</span><span class="nx">onRejected</span><span class="p">)</span> <span class="c1">// helper for onR   ejected method that rethrow the reason of the rejection</span>
<span class="nx">promise</span><span class="p">.</span><span class="nx">rethrow</span><span class="p">()</span> <span class="c1">// see below for more info on rethrow behaviour</span>


</pre></div>

<p>The <strong>apply</strong> method is a minor variation of the <strong>then</strong> method but specifically useful for promises of Array. Instead of getting the promised Array passed as a single parameter to the onFulfilled callback it will apply it to the callback so each values of the promised array will become single parameters of the callback here a code example;</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">arrayPromise</span> <span class="o">=</span> <span class="nx">D</span><span class="p">.</span><span class="nx">resolved</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span> <span class="c1">// we'll talk about resolved later</span>
<span class="nx">arrayPromise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span> <span class="cm">/* a will contains the whole array */</span> <span class="p">})</span>
<span class="nx">arrayPromise</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span> <span class="cm">/* a will be 1, b is 2 and c is 3 */</span> <span class="p">}</span>

</pre></div>

<p>The <strong>rethrow</strong> method serves two different purposes</p>

<ul>
<li>if received an onRejected method it will just ensure that onRejected rethrow the error this is just an helper here's an exemple of the same behaviour without using rethrow
```javascript
var onRejectedResolve = function(reason){
console.error(reason);
return 'resolvedvalue';
}</li>
</ul><p>// first example the error is resolved
promise
    .error(onRejectedResolve)
    .success(function(a){
        /* a now contains 'resolvedvalue' */
    })
;</p>

<p>// second example we want the same errorHandler but we don't want to resolve
promise
    .error(function(reason){
        onRejectedResolve(reason);
        throw reason;
    })
    .success(function(a){
        /* this success will never get called */
    })
;</p>

<p>// third example using the same errorHandler and rethrow. 
//This does exactly the same thing as second example 
promise
    .rethrow(onRejectedResolve)
    .success(function(a){
        /* this success will never get called */
    })
;</p>

<pre><code> - if no onRejected callback is given then it will behave differently. When you use a Promises/A+ library no Error is thrown outside of your promise library so it's sometimes difficult to debug. For this purpose you can use **rethrow** method that will really re-throw the error outside of the promise library. this is really useful for debugging but also to end your promise chain when you want an error to be effectively thrown.
```javascript
promise
    .success(function(){
        throw "there's no good reason";
    })
    .error(function(reason){
        console.error(reason); 
        throw reason; 
        /* 
        even throwing again the reason won't make the reason visible outside the promise library
        the error will go to the next error handler or simply be ignored if no error handler exists
        */
    })
    // rethrow call WITHOUT ANY PARAMATER will rejectet the reason in the outside world and you will see an uncaught error
    .rethrow()
;
</code></pre>

<h2>D properties and methods</h2>

<h4>D() or D.defer()</h4>

<p>return a <strong>deferred</strong> object with <strong>promise</strong> as a property and <strong>resolve</strong>, <strong>fulfill</strong> (alias of resolve), <strong>reject</strong> as methods</p>

<h4>D.alwaysAsync = true</h4>

<p>setting this to false will broke the compliance to the Promises/A+ specification but will try to resolve promise immediatly if the value is available instead of forcing an async resolution this is not a recommended behaviour but it may be useful in some cases</p>

<h4>D.onlyFuncs = true</h4>

<p>This setting passed to false will also break compliance with the Promises/A+ specification by allowing then, success, error, apply and rethrow to received values instead of callbacks for onFulfilled or onRejected and will resolve the promise with thoose values.</p>

<h4>D.resolved(value), D.fulfilled(value)</h4>

<p>return a resolved promise of <strong>value</strong></p>

<h4>D.rejected(reason)</h4>

<p>return a rejected promise with given <strong>reason</strong></p>

<h4>D.wait(time)</h4>

<p>return a promise that will resolve in <strong>time</strong> ms</p>

<h4>D.delay(fn,delay)</h4>

<p>return a promise for the return value of <strong>fn</strong> which will be resolved in <strong>delay</strong> ms</p>

<h4>D.promisify(value)</h4>

<p>internal method exposed that will return a resolved promised of value if value isn't a promise</p>

<h4>D.all(listOfPromise), D.all(promise0,promise1,promise....)</h4>

<p>take a list of promise as single Array or as list or parameters and return a promise that will resolved only when all given promised are resolved. the promise will received given promises values as parameters</p>

<h4>D.nodeCapsule(fn), D.nodeCapsule(subject,fn)</h4>

<p>encapsulate typical node methods that wait for a callback(Err,param1,param2...) as last parameters and return the wrapped method which will return a promise of response usable with then, succes, ...
ie:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">)</span>
    <span class="p">,</span> <span class="nx">D</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./D.js'</span><span class="p">)</span>
    <span class="p">,</span> <span class="nx">readFile</span> <span class="o">=</span> <span class="nx">D</span><span class="p">.</span><span class="nx">nodeStyle</span><span class="p">(</span><span class="nx">fs</span><span class="p">,</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">)</span>
<span class="p">;</span>

<span class="nx">readFile</span><span class="p">(</span><span class="s1">'/etc/passwd'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">rethrow</span><span class="p">()</span>
<span class="p">;</span>

</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">D.js maintained by <a href="https://github.com/malko">malko</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-38585409-3");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
